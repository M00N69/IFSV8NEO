import streamlit as st
import json

# Fonction pour charger le fichier JSON
def load_json(file):
    return json.load(file)

# Fonction pour sauvegarder les modifications dans un fichier JSON
def save_json(data, filename):
    with open(filename, 'w') as f:
        json.dump(data, f, indent=4)

# Interface principale
st.title('Analyse d\'Audit IFS')

uploaded_file = st.file_uploader("Choisissez un fichier IFS (.json)", type="json")

if uploaded_file is not None:
    # Charger et afficher le fichier JSON
    data = load_json(uploaded_file)
    
    # Meta information
    st.subheader('Informations générales')
    st.json({
        "hash": data.get("hash"),
        "schemaVersion": data.get("schemaVersion"),
        "axpxVersion": data.get("axpxVersion"),
        "moduleDefinitionVersion": data.get("moduleDefinitionVersion")
    })

    # Résultats de l'audit
    st.subheader('Résultat de l\'audit')
    result = data.get("data", {}).get("modules", {}).get("food_8", {}).get("result", {})
    st.json(result)

    # Résultats par chapitres
    st.subheader('Résultats par chapitres')
    matrix_result = data.get("data", {}).get("modules", {}).get("food_8", {}).get("matrixResult", [])
    for chapter in matrix_result:
        st.write(chapter)

    # Checklists
    st.subheader('Checklists')
    checklist = data.get("data", {}).get("modules", {}).get("food_8", {}).get("checklists", {}).get("checklistFood8", {})
    st.json(checklist)

    # Sauvegarder les modifications
    if st.button('Enregistrer les modifications'):
        save_json(data, 'modified_audit.json')
        st.success('Fichier JSON sauvegardé avec succès !')
